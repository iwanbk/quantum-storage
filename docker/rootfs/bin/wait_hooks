#!/bin/sh

set -x

sleeppid=0

wait_hooks () {
    while cat /proc/*/comm 2> /dev/null | grep -q '[h]ook.sh'; do
        sleep .1
    done
    echo 'all hooks are dead'
    [ $sleeppid != 0 ] && kill $sleeppid # don't leave the `sleep infinity` dangling
}

trap wait_hooks TERM
sleep infinity &
sleeppid=$!

wait %1
